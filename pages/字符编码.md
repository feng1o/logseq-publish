- [c++中文编码](https://sf-zhou.github.io/programming/chinese_encoding.html) - [binary file diff text file](https://www.codingeek.com/tutorials/c-programming/text-files-vs-binary-files-in-c-programming-language/ https://go.dev/blog/strings)  <span class=" bg-red red  subw9 hblack hover">  *****</span>
- ```
  const sample = "\xbd\xb2\x3d\xbc\x20\xe2\x8c\x98" 
  
  "\xbd\xb2=\xbc ⌘"  ---> \x3d->=  \x20 -> ' '
  # echo -e  "\xbd\xb2\x3d\xbc" 能输出=
  Printf with %+q:
  "\xbd\xb2=\xbc \u2318"
  
  \xe2\x8c\x98 ---》如何映射到 Unicode的 2318?
  ```
- http://www.mytju.com/classcode/tools/encode_utf8.asp
- ![image.png](../assets/image_1665214943755_0.png)
- :%!xxd
- ![image.png](../assets/image_1665214991995_0.png)
- ------
- %uD83D%uDE01  ---》 😁  这个查应该不对
- ![image.png](../assets/image_1665215143185_0.png)
- 解码看代码看： [https://apps.timwhitlock.info/emoji/tables/unicode#block-6c-other-additional-symbols](https://apps.timwhitlock.info/emoji/tables/unicode#block-6c-other-additional-symbols)
- ![image.png](../assets/image_1665215163273_0.png)
- ![image.png](../assets/image_1665215197057_0.png)
  collapsed:: true
	- ```python
	  #! /bin/python
	  # -*- coding: utf-8 -*-
	  import sys
	  import time
	  from kafka import KafkaProducer
	  import json
	  
	  
	  producer = KafkaProducer(bootstrap_servers=['100.122:610'])
	  #future = producer.send('topic01' , key= b'true', value= b'{}', partition= 0)
	  i = 119
	  while i < 120:
	      aaaa="我abc�..."
	      print(aaaa, "; utf8 encode 结果->:", aaaa.encode("utf8"))
	      aaaa="我😁 a"
	      print(aaaa, "; utf8 encode 结果->:", aaaa.encode("utf8"))
	  
	      aaaa=b"a"
	      print(aaaa, "; utf8 encode 结果->:", str(aaaa).encode("utf8"))
	      print(aaaa, "; unicode_escape encode 结果可打印出->:", aaaa.decode("unicode_escape"))
	  
	      aaaa=b"tkex-csig\xe5\x90\x8e\xe5\x8f\xb0\xe5\xae\xa1\xe8\xae\xa1\xe7\xad\x96\xe7\x95\xa5"
	      print(aaaa.decode("utf8"))
	      print(aaaa, "; utf8 encode 结果->:", str(aaaa).encode("utf8"))
	      print(aaaa, "; utf8 decode 结果->:", aaaa.decode("utf8"))
	      print(aaaa, "; unicode_escape encode 结果可打印出->:", aaaa.decode("unicode_escape"))
	  
	  
	      aaaa=b'{"timestamp":1634031060,"threadId":918171393,"checkRows":0,"affectRows":0,"sentRows":0,"lockWaitTime":153,"cpuTime":298319,"ioWaitTime":0,"nsTime":173003352,"trxLivingTime":171,"execTime":299,"errCode":0,"ruleNum":30080,"host":"9xx87.253","instanceName":"cdb-0ptgrxqh","user":"tkex_cmdb","dbName":"db_tkex_cmdb","policyName":"tkex-csig\xe5\x90\x8e\xe5\x8f\xb0\xe5\xae\xa1\xe8\xae\xa1\xe7\xad\x96\xe7\x95\xa5","sql":"-0----------\'"}'
	      print()
	      print(aaaa.decode("utf8"))
	      print(aaaa, "; utf8 encode 结果->:", str(aaaa).encode("utf8"))
	      print(aaaa, "; utf8 decode 结果->:", aaaa.decode("utf8"))
	      print(aaaa, "; unicode_escape encode 结果可打印出->:", aaaa.decode("unicode_escape"))
	  
	      #sys.exit()
	      aaaa=b"\\'\xe4\xbd\xa0"
	      print(aaaa.decode("utf8"))
	      print(aaaa, "; utf8 encode 结果->:", str(aaaa).encode("utf8"))
	      print(aaaa, "; utf8 decode 结果->:", aaaa.decode("utf8"))
	      print(aaaa, "; unicode_escape encode 结果可打印出->:", aaaa.decode("unicode_escape"))
	  
	      aaaa=b"abc\u6211\u221a"
	      print(aaaa, "; utf8 encode 结果->:", str(aaaa).encode("utf8"))
	      print(aaaa, "; unicode_escape encode 结果可打印出->:", aaaa.decode("unicode_escape"))
	  
	      aaaa=b"\xbd\xb2\x3d\xbc\x20\xe2\x8c\x98"
	      print(aaaa, "; utf8 encode 结果->:", str(aaaa).encode("utf8"))
	      print(aaaa, "; unicode_escape encode 结果可打印出->:", aaaa.decode("unicode_escape"))
	      print(str(aaaa).encode("utf8").decode("utf8"))
	  
	      aaaa=b"\xbd\xb2\x3d\xbc\u2318" #\xbc =; \x20 空格;  \xe2\x8c\x98 --> 2318
	      print(aaaa, "; utf8 encode 结果->:", str(aaaa).encode("utf8"))
	      print(aaaa, "; unicode_escape encode 结果可打印出->:", aaaa.decode("unicode_escape"))
	      print(str(aaaa).encode("utf8").decode("utf8"))
	  
	      #sys.exit()
	  
	      id="test_" + str(i)
	      id_a="{\"instanceId\":\"testxxxx\",\"msgId\":\"test_id_" + id + "\"}"
	      print(id_a)
	      # 正常msg
	      #future = producer.send('cmz1_test_topic1' , key=bytes(id_a, encoding='utf8'), value= b'{ "cluster" : "cmgo-prg92p9r", "atype" : "insert", "ts" : "2021-05-31T15:30:54.847+0800", "timestamp" : 1622446254, "remote" : { "ip" : "127.x.0.1", "port" : 39397 }, "local" : { "ip" : "x.x.x.x", "port" : 7061 }, "users" : "mongouser@admin", "roles" : "dbAdminAnyDatabase@admin,readWriteAnyDatabase@admin,restoreoplog@admin,clusterAdmin@admin,backup@admin,restore@admin", "duration_ms" : 0, "param" : "x", "stats" : { "nDocs" : 1 }, "result" : 0 }', partition= 0)
	      a = '{"timestamp":1632312385,"threadId":8844927,"checkRows":1,"affectRows":1,"sentRows":0,"lockWaitTime":3360,"cpuTime":5189888,"ioWaitTime":110,"nsTime":104781778,"trxLivingTime":1847,"execTime":5186,"errCode":0,"ruleNum":15844,"host":"x.x.x.x","user":"root","dbName":"hl_game_s1","policyName":"dbbrain_fullaudit","sql":"update user_data set nick=\'你东西掉啦\',role_id=1,all_blob=\/?ެ你东西掉啦�^A2^C^H/�^A2^H^H/�^A^P�/�/�\'","sqlType":"EXECUTE"}'
	      a = '{\"timestamp\":1632312385,\"threadId\":8844927,\"checkRows\":1,\"affectRows\":1,\"sentRows\":0,\"lockWaitTime\":3360,\"cpuTime\":5189888,\"ioWaitTime\":110,\"nsTime\":104781778,\"trxLivingTime\":1847,\"execTime\":5186,\"errCode\":0,\"ruleNum\":15844,\"host\":\"x.x.x.x\",\"user\":\"root\",\"dbName\":\"hl_game_s1\",\"policyName\":\"dbbrain_fullaudit\",\"sql\":\"insert into t set a = ----BBB-2-\\\"\' \tx\'x\'\n\",\"sqlType\":\"EXECUTE\"}'
	      print (a.encode("utf-8"))
	      print (a.encode("utf-8").decode("utf-8"))
	      print("---------")
	      #print (json.loads(a))
	      id="test_" + str(i)
	      id_a="{\"instanceId\":\"testxxxx\",\"msgId\":\"test_id_" + id + "\"}"
	      print(id_a)
	      #future = producer.send('cmongo_gz1_topic1' , key=bytes(id_a, encoding='utf8'), value= b'{"abc":"test可那个"}', partition= 0)
	      #sys.exit()
	      future = producer.send('cmo_gz1_test_topic1' , key=bytes(id_a, encoding='utf8'), value= a.encode("utf8"),partition= 0)
	      result = future.get(timeout= 1)
	      print(result)
	      #time.sleep(13)
	      #future = producer.send('cm_gz1_test_topic1' , key=bytes(id_a, encoding='utf8'), value= b'{"timestamp":1632312385,"threadId":8844927,"checkRows":1,"affectRows":1,"sentRows":0,"lockWaitTime":3360,"cpuTime":5189888,"ioWaitTime":110,"nsTime":104781778,"trxLivingTime":1847,"execTime":5186,"errCode":0,"ruleNum":15844,"host":"x.x.x.x","user":"root","dbName":"hl_game_s1","policyName":"dbbrain_fullaudit","sql":"update user_data set nick=\'你东西掉啦\',role_id=1,all_blob=\/?ެ你东西掉啦","sqlType":"EXECUTE"}', partition= 0)
	      i = i + 1
	      #result = future.get(timeout= 1)
	  
	      # 测试ok
	      #future = producer.send('cm_gz2_test_topic1' , key=b'{"instanceId":"cmgo-prg92p9r","msgId":"test_id_"' + bytes(id, encoding="utf8") + '"}"', value= b'{ "cluster" : "cmgo-prg92p9r", "atype" : "insert", "ts" : "2021-05-31T15:30:54.847+0800", "timestamp" : 1622446254, "remote" : { "ip" : "127.x.0.1", "port" : 39397 }, "local" : { "ip" : "x.x.x.x", "port" : 7061 }, "users" : "mongouser@admin", "roles" : "dbAdminAnyDatabase@admin,readWriteAnyDatabase@admin,restoreoplog@admin,clusterAdmin@admin,backup@admin,restore@admin", "duration_ms" : 0, "param" : "{ ns: \"records.people1\", cmd: \"{ _id: ObjectId("60b490aed9fccb54d10a310e"), age: 93.0, name: \"user3624193\", create_at: new Date(1622446254840) }\" }", "stats" : { "nDocs" : 1 }, "result" : 0 }', partition= 0)
	      #result = future.get(timeout= 1)
	      #print(result)
	      #time.sleep(13)
	  ```
- ![image.png](../assets/image_1665215246143_0.png)
- 可以看出go+q输出的是unicode的编码，并不是utf8的
-
- ----
- 那 这个emoj编码从uinoce没查到 [https://apps.timwhitlock.info/emoji/tables/unicode#block-6c-other-additional-symbols](https://apps.timwhitlock.info/emoji/tables/unicode#block-6c-other-additional-symbols)
- ![image.png](../assets/image_1665215364142_0.png)
- ----
- 关于emoji的编码python演示： [https://segmentfault.com/a/1190000007594620](https://segmentfault.com/a/1190000007594620)
- ```
  # -*- coding: utf-8 -*-
  # more info to see https://en.wikipedia.org/wiki/Emoji
  # 符号分别是上图(截图自wiki)中的符号, 最后再加上一个“狗”的Emoji
  sample_list = [u'\u2139', u'\u231B', u'\u26A0', u'\u2712', u'\u2764', u'\U0001F004', u'\U0001F21A', u'\U0001f436', ]
  
  # 输出原样式
  for code in sample_list:
      print code,
  print
  print '-' * 20
  # 后面加上VS-15
  for code in sample_list:
      print (code + u'\uFE0E'),
  print
  print '-' * 20
  # 后面加上VS-16
  for code in sample_list:
      print (code + u'\uFE0F'),
  ```
- ![image.png](../assets/image_1665215409817_0.png)
-
- -----
- 2021-10-14:
- hl_game_s1","policyName":"dbbrain_fullaudit","sql":"update user_data
- 为何MySQL中的latin1可以支持编码emoji，中文？ [http://cppstore.com/article-641.html](http://cppstore.com/article-641.html)
- ![image.png](../assets/image_1665215464691_0.png)
- ![image.png](../assets/image_1665215514960_0.png)
- ----
- 2021-10-18: 发现python读取文件后， errors='ignore' 可以上报，序列化
- ![image.png](../assets/image_1665215556813_0.png)
- ![image.png](../assets/image_1665215574448_0.png)
- [https://segmentfault.com/a/1190000030685697](https://segmentfault.com/a/1190000030685697)  go里的字符串编码可看  byte rune等问题
- ----
- 10.20:
- 控制字符0-31 127： [https://en.wikipedia.org/wiki/ASCII](https://en.wikipedia.org/wiki/ASCII)
- ctsdb不支持控制字符的序列化：
- ![image.png](../assets/image_1665215625988_0.png)
- code block
  collapsed:: true
	- ```python
	  #! /bin/python
	  # -*- coding: utf-8 -*-
	  
	  # test_encoding_err_readfile.py
	  import sys
	  import time
	  import json
	  from kafka import KafkaProducer
	  
	  
	  producer = KafkaProducer(bootstrap_servers=['100.11.50:730'])
	  #future = producer.send('topic01' , key= b'true', value= b'{}', partition= 0)
	  i = 99 
	  while i < 100:
	      i = i + 1
	      #a='{ "cluster" : "cmgo-if84zmb3", "atype" : "read", "ts" : "2021-07-26T14:57:20.309+0800", "timestamp" : 1627282640, "remote" : { "ip" : "127.x.0.1", "port" : 33640 }, "local" : { "ip" : "127.x.0.1", "port" : 6004 }, "users" : "mongouser@admin", "roles" : "dbAdminAnyDatabase@admin,readWriteAnyDatabase@admin,restoreoplog@admin,clusterAdmin@admin,backup@admin,restore@admin", "duration_ms" : 2, "param" : "{ ns: \\"usercenter.live_room_audience\\", cmd: \\"{ aggregate: \\"live_room_audience\\", pipeline: [ { $match: { roomId: \\"lec1408_c112322\\", followed: false, userOnlineNum: { $gt: 0 } } }, { $group: { _id:...\\" }", "stats" : { "nDocs" : 1 }, "result" : 0 }'
	      #a='{ "cluster" : "cmgo-if84zmb3", "atype" : "insert", "ts" : "2021-07-23T11:33:39.537+0800", "timestamp" : 1627011219, "remote" : { "ip" : "127.x.0.1", "port" : 34374 }, "local" : { "ip" : "127.x.0.1", "port" : 6004 }, "users" : "hs_write@admin", "roles" : "dbAdmin@hsdb,readWrite@hsdb", "duration_ms" : 0, "param" : "{ ns: \\\"hsdb.hs_video_destinies,\\"}", "stats" : { "nDocs" : 1 }, "result" : 0 }'
	      #a='{ "cluster" : "cmgo-if84zmb3", "atype" : "insert", "ts" : "2021-07-23T11:33:39.537+0800", "timestamp" : 1627011219, "remote" : { "ip" : "127.x.0.1", "port" : 34374 }, "local" : { "ip" : "127.x.0.1", "port" : 6004 }, "users" : "hs_write@admin", "roles" : "dbAdmin@hsdb,readWrite@hsdb", "duration_ms" : 0, "param" : "{ ns: \\"hsdb.hs_video_destinies\\", cmd: \\"{ insert: \\"hs_video_destinies\\", bypassDocumentValidation: false, ordered: true, documents: [ { _id: ObjectId(60fa38936810130039ec60d7), title: \\"看\\ufffd...\\" }", "stats" : { "nDocs" : 1 }, "result" : 0 }'
	      a='{ "cluster" : "yinchao-audit", "atype" : "read", "ts" : "2021-07-28T00:16:00.756+0800", "timestamp" : 1627402560, "remote" : { "ip" : "127.x.0.1", "port" : 50842 }, "local" : { "ip" : "127.x.0.1", "port" : 6004 }, "users" : "hs_write@admin", "roles" : "dbAdmin@hsdb,readWrite@hsdb", "duration_ms" : 8, "param" : "{ ns: \\"hsdb.hs_wechat_developers_docs\\", cmd: \\"{ find: \\"hs_wechat_developers_docs\\", filter: { url: \\"https://developers.weixin.qq.com/miniprogram/product/#_5-23-违反平台运营规范的其他内�...^H/?ެ^C^R^O你东西掉啦^X^A ^A2^G^H^A^P/??/?^\\" }", "stats" : { "nDocs" : 1 }, "result" : 0 }'
	      a='😈🤠 Lorem ^H/?ެ^C^R^O你东西掉啦^X^A ^A2^G^H^A^P/??/?^Ipsum Dolor sit Amet 😱 /��^F2^E^H�^F^P 2^H^H�^F^P�~'
	      #fo = open("skiped_msgs_229be8b8-7c71-11ea-86cc-6c92bf479dfd-xold", encoding='utf-8-sig', errors='ignore')
	      #fo = open("skiped_msgs_229be8b8-7c71-11ea-86cc-6c92bf479dfd-xn", encoding='utf-8-sig') #不行,errors必须ignore
	      #fo = open("skiped_msgs_229be8b8-7c71-11ea-86cc-6c92bf479dfd-2xnew", encoding='utf8') #不行,errors必须ignore
	      fo = open("parse_err.txt", encoding='utf8') #不行,errors必须ignore
	      #fo = open("parse_err.txt-x", encoding='utf8') #不行,errors必须ignore
	      #fo = open("parse_err.txt-x", encoding='utf-8-sig', errors='ignore')
	      #fo = open("skiped_msgs_229be8b8-7c71-11ea-86cc-6c92bf479dfd", "rb")
	      #a=str(fo.readline().decode("utf8"))
	      a=fo.readline()
	      print ("len = ", len(a))
	      print("readline:", str(a))
	      #print ("尝试encode: decode", a.encode("utf8").decode("utf8"))
	      print ("尝试json loads:", json.loads(a.encode("utf8").decode("utf8"), strict=False))
	      print ("尝试json loads:", json.loads(str(a), strict=False))
	  
	      """
	      fo = open("skiped_msgs_229be8b8-7c71-11ea-86cc-6c92bf479dfd", "rb")
	      a = fo.read(32089)
	      print(a.encode())
	      print("----尝试ingreod---line: ", a.decode(encoding='utf8'))
	      print("----尝试ingreod---line: ", a.decode(encoding='utf8', errors='ignore'))
	      a=a.decode(encoding='utf8', errors='ignore')
	      #print("----尝试ingreod无---line: ", a.decode(encoding='utf8'))
	      print("")
	  
	      #sys.exit()
	      fo = open("skiped_msgs_229be8b8-7c71-11ea-86cc-6c92bf479dfd-2", "rb")
	      a = fo.read(376)
	      print("line: ", a.decode('utf8'))
	      print("")
	      print ("endode utf8:后的结果=:", a) #$a.encode("utf8"))
	      print("---------")
	      print("str: ", str(a))
	      print("str encode: ", a.encode("utf8"))
	      print ("尝试json loads:", json.loads(str(a)))
	      """
	      id="test_" + str(i)
	      id_a="{\"instanceId\":\"testxxxx\",\"msgId\":\"test_id_" + id + "\"}"
	      print(id_a)
	      #future = producer.send('cmgo_gz1_topic1' , key=bytes(id_a, encoding='utf8'), value= b'{"abc":"test"}', partition= 0)
	      #result = future.get(timeout= 1)
	      #print(result)
	      future = producer.send('cmo_gz1_test_topic1' , key=bytes(id_a, encoding='utf8'), value= a.encode("utf8"),partition= 0)
	      result = future.get(timeout= 1)
	      print(result)
	      print()
	      print(a.encode('utf8'))
	      #time.sleep(13)
	      #sys.exit()
	  ```
